function withLazyRender(e){return{...e,created(){e.created&&e.created.call(this),this.elementVisible=!1,this.intersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&!this.elementVisible&&(this.elementVisible=!0,this.intersectionObserver.disconnect(),this._processRender())}))}),{threshold:.1}),this.intersectionObserver.observe(this)},removed(){e.removed&&e.removed.call(this),this.intersectionObserver&&this.intersectionObserver.disconnect()}}}function withStyles(e){return{...e,created(){e.styles&&"function"==typeof e.styles&&(globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.styles=globalThis.__ficusjs__.styles||{},this._injectStyles(e.styles())),e.created&&e.created.call(this)},_isStyleSheet:e=>"object"==typeof e&&e.tagName&&"style"===e.tagName.toLowerCase(),async _injectStyles(e){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.styles&&globalThis.__ficusjs__.styles[this.componentTagName])return;if(globalThis.__ficusjs__.styles[this.componentTagName]={loaded:!1},Array.isArray(e)&&e.filter((e=>"string"!=typeof e&&!this._isStyleSheet(e))).length||!Array.isArray(e)&&"string"!=typeof e&&!this._isStyleSheet(e))return void console.error("Dude, styles must return a CSS string or an array of CSS strings!");let t;t=Array.isArray(e)?await Promise.all(e.map((e=>this._processStyle(e,this.componentTagName)))):await this._processStyle(e,this.componentTagName),globalThis.__ficusjs__.styles[this.componentTagName].styles=t,globalThis.__ficusjs__.styles[this.componentTagName].loaded=!0,this.areStylesInjected=!0},_injectStylesheet(e){document.getElementsByTagName("head")[0].appendChild(e)},async _processStyle(e,t){if(this._isStyleSheet(e))return e.setAttribute("data-tag",t),this._injectStylesheet(e),e;if(/http[s]?:\/\/.+\.css$/.test(e)){const s=document.createElement("link");return s.rel="stylesheet",s.type="text/css",s.href=e,s.setAttribute("data-tag",t),document.head.appendChild(s),s}return/.+\.css$/.test(e)?globalThis.fetch(e).then((e=>e.text())).then((e=>this._createAndInjectStylesheet(e,{"data-tag":t}))):this._createAndInjectStylesheet(e,{"data-tag":t})},_createAndInjectStylesheet(e,t){const s=this._createStyle(e);return this._setElementAttributes(s,t),this._injectStylesheet(s),s},_createStyle(e){const t=document.createElement("style");return t.appendChild(document.createTextNode(e)),t},_setElementAttributes(e,t){t&&Object.keys(t).forEach((s=>{e.setAttribute(s,t[s])}))}}}function withBreakpointRender(e,t){return{...t,created(){this.setBreakpointConfig(e),t.created&&t.created.call(this)},mounted(){this._addBreakpointListeners(),t.mounted&&t.mounted.call(this)},updated(){this._addBreakpointListeners(),t.updated&&t.updated.call(this)},removed(){this._removeBreakpointListeners(),t.removed&&t.removed.call(this)},_addBreakpointListeners(){const e=this;e._breakpointConfig&&e._breakpointConfig.reactive&&e._breakpointListeners.forEach((e=>{if(!e.listenerSubscribed){const t=window.matchMedia(e.query);t.addEventListener("change",e.listener),e.mediaQueryList=t,e.listenerSubscribed=!0}}))},_removeBreakpointListeners(){const e=this;e._breakpointListeners&&e._breakpointListeners.forEach((e=>{e.mediaQueryList&&(e.mediaQueryList.removeEventListener("change",e.listener),e.listenerSubscribed=!1)}))},setBreakpointConfig(e){const t=this;t._breakpointConfig=e;const s=Object.keys(e.breakpoints).sort(((e,t)=>e-t)),i=s.map(((i,r)=>{let n;0===r?n=`only screen and (max-width: ${i}px)`:r===s.length-1?(n=`only screen and (min-width: ${parseInt(s[r-1],10)+1}px) and (max-width: ${i}px)`,n=`only screen and (min-width: ${parseInt(i,10)+1}px)`):n=`only screen and (min-width: ${parseInt(s[r-1],10)+1}px) and (max-width: ${i}px)`;const a=e.breakpoints[i].method;return{query:n,method:a,listener(e){e.matches&&t[a]&&(t.render=t[a],t._processRender())},mediaQueryList:void 0,listenerSubscribed:!1}}));t._removeBreakpointListeners(),this._breakpointListeners=i,t._addBreakpointListeners(),i.forEach((e=>{e.mediaQueryList.matches&&t[e.method]&&(t.render=t[e.method])}))}}}export{withBreakpointRender,withLazyRender,withStyles};
